# Страница профиля пользователя

## Обзор

Реализована полноценная страница профиля пользователя с разделами информации, статистики и настроек.

## API Endpoints

### UserController (`/api/user`)

#### `GET /api/user/me`
Получить полную информацию о текущем пользователе, включая:
- Основные данные (username, email, balance)
- Информацию о подписке
- Быструю статистику (профили, платежи, депозиты)

**Ответ:**
```json
{
  "id": 1,
  "username": "user123",
  "email": "user@example.com",
  "balance": 125.50,
  "createdAt": "2025-01-01T00:00:00Z",
  "lastLoginAt": "2025-12-08T10:30:00Z",
  "isActive": true,
  "isAdmin": false,
  "twoFactorEnabled": false,
  "subscription": {
    "tier": "Pro",
    "maxProfiles": 10,
    "startDate": "2025-01-01T00:00:00Z",
    "endDate": null,
    "isActive": true
  },
  "stats": {
    "totalProfiles": 5,
    "activeProfiles": 2,
    "totalPayments": 10,
    "totalDeposits": 3,
    "completedDeposits": 3
  }
}
```

#### `GET /api/user/statistics`
Получить детальную статистику пользователя:
- Статистика профилей (всего, по статусам, создано за 30 дней)
- Статистика платежей (всего, завершено, потрачено)
- Статистика пополнений (всего, завершено, ожидание, пополнено)
- Недавняя активность

**Ответ:**
```json
{
  "profiles": {
    "total": 5,
    "byStatus": {
      "Running": 2,
      "Stopped": 3
    },
    "createdLast30Days": 2
  },
  "payments": {
    "total": 10,
    "completed": 8,
    "totalSpent": 250.00,
    "lastPayment": "2025-12-07T15:30:00Z"
  },
  "deposits": {
    "total": 3,
    "completed": 3,
    "pending": 0,
    "expired": 0,
    "totalDeposited": 300.00,
    "lastDeposit": "2025-12-06T12:00:00Z"
  },
  "recentActivity": [
    {
      "profileId": 1,
      "profileName": "Profile 1",
      "lastStartedAt": "2025-12-08T09:00:00Z",
      "status": "Running"
    }
  ]
}
```

#### `PUT /api/user/profile`
Обновить информацию профиля (username, email).

**Запрос:**
```json
{
  "username": "newusername",
  "email": "newemail@example.com"
}
```

#### `POST /api/user/change-password`
Изменить пароль пользователя.

**Запрос:**
```json
{
  "currentPassword": "oldpassword",
  "newPassword": "newpassword"
}
```

## Frontend

### Страница профиля (`/dashboard/profile`)

Страница состоит из 4 основных разделов (табов):

#### 1. Обзор (Overview)
- Информация об аккаунте:
  - Имя пользователя
  - Email
  - Баланс
  - Роль (Администратор/Пользователь)
  - Статус 2FA
  - Дата регистрации
  - Последний вход
- Информация о подписке:
  - Текущий план
  - Максимальное количество профилей
  - Статус подписки
  - Дата окончания (если есть)
- Быстрая статистика:
  - Всего профилей
  - Активных профилей
  - Количество платежей
  - Количество пополнений

#### 2. Статистика (Statistics)
- **Статистика профилей:**
  - Всего профилей
  - Активных
  - Создано за последние 30 дней
  - Распределение по статусам
- **Статистика платежей:**
  - Всего платежей
  - Завершенных
  - Общая сумма потраченных средств
  - Дата последнего платежа
- **Статистика пополнений:**
  - Всего пополнений
  - Завершенных
  - Ожидающих
  - Просроченных
  - Общая сумма пополнений
  - Дата последнего пополнения
- **Недавняя активность:**
  - Список последних запущенных профилей с датами

#### 3. Настройки (Settings)
- Редактирование профиля:
  - Изменение имени пользователя
  - Изменение email
  - Валидация уникальности
  - Сохранение изменений

#### 4. Безопасность (Security)
- **Изменение пароля:**
  - Текущий пароль
  - Новый пароль
  - Подтверждение пароля
  - Показ/скрытие паролей
  - Валидация (минимум 6 символов)
- **Двухфакторная аутентификация:**
  - Статус 2FA (включена/отключена)
  - Кнопка включения/отключения
  - Описание защиты

## Навигация

В Layout добавлена ссылка на профиль:
- Иконка профиля в верхней панели навигации
- Клик по имени пользователя ведет на страницу профиля
- Старая страница `/dashboard/account` автоматически редиректит на `/dashboard/profile`

## Интернационализация

Добавлены переводы для всех элементов страницы профиля:
- Русский (`ru.json`)
- Английский (`en.json`)

Все тексты вынесены в файлы локализации для поддержки мультиязычности.

## Безопасность

- Все endpoints требуют авторизации (`[Authorize]`)
- Проверка принадлежности данных пользователю
- Валидация входных данных
- Хеширование паролей при изменении (BCrypt)
- Проверка уникальности username и email

## Использование

1. Перейдите на `/dashboard/profile`
2. Выберите нужный раздел в табах
3. Просмотрите информацию, статистику или измените настройки
4. Сохраните изменения при необходимости

## Технические детали

### Backend
- **Контроллер:** `UserController.cs`
- **Модели:** Используются существующие модели `User`, `BrowserProfile`, `Payment`, `DepositRequest`
- **База данных:** PostgreSQL через Entity Framework Core

### Frontend
- **Страница:** `client-web-nextjs/app/dashboard/profile/page.tsx`
- **Компоненты:** Разделены на отдельные функции для каждого таба
- **Состояние:** Используется `useAuthStore` для получения токена авторизации
- **Стили:** Tailwind CSS с поддержкой темной темы

## Будущие улучшения

- [ ] Добавление API ключей для интеграций
- [ ] Настройки уведомлений (email, push)
- [ ] История активности (логи действий)
- [ ] Экспорт данных профиля
- [ ] Удаление аккаунта
- [ ] Настройки приватности
