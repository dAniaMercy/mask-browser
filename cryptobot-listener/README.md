# CryptoBot Listener

Python –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ Telegram CryptoBot.

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å —Å–ª—É—à–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç @CryptoBot –≤ Telegram, –ø–∞—Ä—Å–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–æ–ª–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ Mask Browser.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Telethon** - –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram API
- **asyncpg** - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- **Redis** - –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- **aiohttp** - –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–π API

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
```bash
cp .env.example .env
```

3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`:
- `TELEGRAM_API_ID` - ID –≤–∞—à–µ–≥–æ Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `TELEGRAM_API_HASH` - Hash –≤–∞—à–µ–≥–æ Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `TELEGRAM_PHONE` - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:
```bash
python -m app.main
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Telethon –∑–∞–ø—Ä–æ—Å–∏—Ç –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑ SMS.

### Docker Compose

–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏:

```bash
cd infra
docker-compose up -d cryptobot-listener
```

–ò–ª–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
docker-compose up -d
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|-------------|--------------|
| `TELEGRAM_API_ID` | Telegram API ID | –î–∞ | - |
| `TELEGRAM_API_HASH` | Telegram API Hash | –î–∞ | - |
| `TELEGRAM_PHONE` | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ | –î–∞ | - |
| `DATABASE_URL` | PostgreSQL connection string | –ù–µ—Ç | postgresql://maskuser:maskpass123@postgres:5432/maskbrowser |
| `REDIS_URL` | Redis connection string | –ù–µ—Ç | redis://redis:6379 |
| `MAIN_API_WEBHOOK_URL` | URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ webhook | –ù–µ—Ç | http://api:8080/api/deposit/webhook/cryptobot |
| `WEBHOOK_SECRET` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ webhook | –ù–µ—Ç | super_secret_webhook |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | –ù–µ—Ç | INFO |

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞—è–≤–∫—É –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π API
2. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ `MASK-XXXXXX`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–ª–∞—Ç–µ–∂ –≤ @CryptoBot —Å —ç—Ç–∏–º –∫–æ–¥–æ–º –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
4. CryptoBot –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–ª–∞—Ç–µ–∂–µ
5. `cryptobot-listener` –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–∞—Ä—Å–∏—Ç –µ–≥–æ –∏ –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞—è–≤–∫—É –ø–æ –∫–æ–¥—É
6. –°–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Redis
7. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ –∏ –ø–æ–ø–æ–ª–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
8. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –≤ –æ—Å–Ω–æ–≤–Ω–æ–π API –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç CryptoBot

–°–µ—Ä–≤–∏—Å –ø–∞—Ä—Å–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∏–¥–∞:
```
let name="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
–æ–ø–ª–∞—Ç–∏–ª(–∞) –≤–∞—à —Å—á—ë—Ç #IV39234014. –í—ã –ø–æ–ª—É—á–∏–ª–∏ üü¢ 5 USDT ($5).
```

–ö–æ–¥ –ø–ª–∞—Ç–µ–∂–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ `MASK-XXXXXX` –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–ª–∞—Ç–µ–∂—É.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ stdout –∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω—ã —á–µ—Ä–µ–∑ Promtail/Loki.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç healthcheck, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å Python –∑–∞–ø—É—â–µ–Ω.

## Troubleshooting

### –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs cryptobot-listener`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∏ Redis –¥–æ—Å—Ç—É–ø–Ω—ã

### –ü–ª–∞—Ç–µ–∂–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Telegram —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞ (—Ñ–∞–π–ª –≤ `/app/sessions/`)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç @CryptoBot –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–∞–∫—Ç—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∫–æ–¥–∞ –ø–ª–∞—Ç–µ–∂–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `MASK-XXXXXX`)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞

### Webhook –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `WEBHOOK_SECRET` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º API
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
